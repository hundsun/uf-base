<?xml version="1.0" encoding="UTF-8"?>
<atom:AtomService xmlns:atom="http://www.hundsun.com/ares/studio/cres/atom/1.0.0" interfaceFlag="" name="r_2100016" chineseName="AS_演示用户管理_中间件循环更新数据注意点" description="中间件循环更新数据注意点" objectId="2100016" database="USERDB" pseudoCode="/********************************************************************&#xA;**&#xA;** [中间件循环更新数据注意点]&#xA;**   功能：描述循环更新的错误写法和证券写法&#xA;**   范围：原子服务、原子函数&#xA;**   注意：对于游标更新数据的操作不要更新当前游标数据，否则会导致游标失效&#xA;**&#xA;********************************************************************/&#xA;&#xA;// 问题写法：这种写法会导致游标失效，因为循环过程中修改了游标的数据，要解决这种问题，要把&#xA;//         [PRO*C结果集语句]调用方式修改为函数调用方式&#xA;[PRO*C结果集语句][select user_id,branch_no,user_type,id_no,id_kind,user_status,income&#xA;from demoinfo&#xA;where (user_id = @user_id or trim(@user_id) is null)][demoinfo]&#xA;{&#xA;[PRO*C记录获取开始][@user_id,@branch_no,@user_type,@id_no,@id_kind,@user_status,@income]&#xA;//E：如果函数出现异常需要关闭游标&#xA;sprintf(@subentry,&quot;%c&quot;,@user_type);&#xA;&lt;E>[AF_系统公用_参数表内存获取][dict_entry=1025,dict_prompt=@user_type_name]&#xA;&#xA;//E：如果函数出现异常需要关闭游标&#xA;&lt;E>[AF_演示用户管理_UPDATE异常控制]&#xA;//内存数据库字典翻译等操作...&#xA;[PRO*C记录获取结束][@user_id,@branch_no,@user_type,@id_no,@id_kind,@user_status,@income]&#xA;}&#xA;else&#xA;{&#xA;[PRO*C结果集函数报错返回][ERR_USER_QRY_DEMOINFO_FAIL][查询演示信息失败][@user_id]&#xA;}&#xA;&#xA;// 正常写法&#xA;[AF_演示用户管理_演示信息获取]&#xA;{&#xA;while (!lpResultSet->IsEOF())&#xA;{&#xA;hs_strcpy(@user_id,lpResultSet->GetStr(&quot;user_id&quot;));&#xA;@branch_no = lpResultSet->GetInt(&quot;branch_no&quot;);&#xA;@user_type = lpResultSet->GetChar(&quot;user_type&quot;);&#xA;hs_strcpy(@id_no,lpResultSet->GetStr(&quot;id_no&quot;));&#xA;@id_kind = lpResultSet->GetChar(&quot;id_kind&quot;);&#xA;@user_status = lpResultSet->GetChar(&quot;user_status&quot;);&#xA;@income = lpResultSet->GetDouble(&quot;income&quot;);&#xA;lpResultSet->Next();&#xA;sprintf(@subentry,&quot;%c&quot;,@user_type);&#xA;[AF_系统公用_参数表内存获取][dict_entry=1025,dict_prompt=@user_type_name]&#xA;[AF_演示用户管理_UPDATE异常控制]&#xA;}&#xA;}&#xA;&#xA;&#xA;">
  <inputParameters id="dict_entry" flags=""/>
  <inputParameters id="branch_no" flags=""/>
</atom:AtomService>
